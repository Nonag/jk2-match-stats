// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model Match {
  id           String        @id @default(cuid())
  blueScore    Int
  createdAt    DateTime      @default(now())
  date         DateTime
  duration     Int           // Match length in minutes
  fileName      String        @unique
  mapName      String
  matchPlayers MatchPlayer[]
  redScore     Int
  serverIp     String
  serverName   String
  updatedAt    DateTime      @updatedAt
}

model MatchPlayer {
  id                String   @id @default(cuid())
  accuracyWeird     Int
  assistsCurrent    Int
  assistsSum        Int
  bcCurrent         Int      // Base clean current
  bcSum             Int      // Base clean sum
  blocksEnemy       Int
  blocksEnemyCapper Int
  blocksTeam        Int
  blocksTeamCapper  Int
  blubsAttempts     Int
  blubsKills        Int
  blubsReturns      Int
  bluKills          Int
  bluReturns        Int
  bsAttempts        Int
  bsKills           Int
  bsReturns         Int
  capturesCurrent   Int
  capturesSum       Int
  clientNumber      Int
  createdAt         DateTime @default(now())
  dbsAttempts       Int
  dbsKills          Int
  dbsReturns        Int
  deaths            Int
  dfaAttempts       Int
  dfaKills          Int
  dfaReturns        Int
  doomKills         Int
  doomReturns       Int
  flagGrabsCurrent   Int
  flagGrabsSum       Int
  flagHoldCurrent    Int
  flagHoldSum        Int
  gauntletCurrent   Int      // Legacy stat
  gauntletSum       Int      // Legacy stat
  glicko2Deviation  Float
  glicko2Rating     Float
  idleKills         Int
  idleReturns       Int
  kills             Int
  lastNonSpecTeam   String
  match             Match    @relation(fields: [matchId], references: [id], onDelete: Cascade)
  matchId           String
  mineGrabsBlueBase Int
  mineGrabsNeutral  Int
  mineGrabsRedBase  Int
  mineGrabsTotal    Int
  mineKills         Int
  mineReturns       Int
  nameClean         String
  nameRaw           String
  pingCurrent       Int
  pingMean          Int
  pingMeanDeviation Int
  player            Player?  @relation(fields: [playerId], references: [id], onDelete: SetNull)
  playerId          String?
  redKills          Int
  redReturns        Int
  returnsCurrent    Int
  returnsSum        Int
  scoreCurrent      Int
  scoreSum          Int
  spreeKillsCurrent Int      // Legacy stat
  spreeKillsSum     Int      // Legacy stat
  team              String
  timeCurrent       Int
  timeSum           Int
  totalKillsMoh     Int
  turKills          Int
  turReturns        Int
  unknKills         Int
  unknReturns       Int
  upcutKills        Int
  upcutReturns      Int
  ydfaAttempts      Int
  ydfaKills         Int
  ydfaReturns       Int
  yelKills          Int
  yelReturns        Int
}

model Player {
  id           String        @id @default(cuid())
  aliases      PlayerAlias[]
  createdAt    DateTime      @default(now())
  matchPlayers MatchPlayer[]
  primaryName  String
  updatedAt    DateTime      @updatedAt
}

model PlayerAlias {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  nameClean String
  nameRaw   String
  player    Player   @relation(fields: [playerId], references: [id], onDelete: Cascade)
  playerId  String

  @@unique([nameClean, playerId])
}
