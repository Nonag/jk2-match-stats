// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model Player {
  id           String         @id @default(cuid())
  primaryName  String
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  aliases      PlayerAlias[]
  matchPlayers MatchPlayer[]
}

model PlayerAlias {
  id        String   @id @default(cuid())
  nameClean String
  nameRaw   String
  playerId  String
  player    Player   @relation(fields: [playerId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@unique([nameClean, playerId])
}

model Match {
  id            String        @id @default(cuid())
  date          DateTime
  mapName       String
  serverIp      String
  serverName    String
  fileName      String        @unique
  redScore      Int
  blueScore     Int
  duration      Int           // in minutes
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  matchPlayers  MatchPlayer[]
}

model MatchPlayer {
  id              String   @id @default(cuid())
  matchId         String
  match           Match    @relation(fields: [matchId], references: [id], onDelete: Cascade)
  playerId        String?
  player          Player?  @relation(fields: [playerId], references: [id], onDelete: SetNull)

  // Basic info
  clientNumber    Int
  team            String   // Red, Blue, Spectator
  lastNonSpecTeam String   // LAST-NONSPEC-TEAM
  nameClean       String
  nameRaw         String

  // Score stats
  scoreCurrent    Int
  scoreSum        Int

  // CTF stats
  capturesCurrent Int
  capturesSum     Int
  returnsCurrent  Int
  returnsSum      Int
  bcCurrent       Int      // Base clean kills current
  bcSum           Int      // Base clean kills sum
  assistsCurrent  Int
  assistsSum      Int

  // Flag stats (newer format - may be 0 in older files)
  flagHoldCurrent Int
  flagHoldSum     Int
  flagGrabsCurrent Int
  flagGrabsSum    Int

  // Legacy stats (older format - may be 0 in newer files)
  gauntletCurrent Int
  gauntletSum     Int
  spreeKillsCurrent Int
  spreeKillsSum   Int

  // Mine stats
  mineGrabsTotal   Int
  mineGrabsRedBase Int
  mineGrabsBlueBase Int
  mineGrabsNeutral Int

  // Combat stats
  accuracyWeird   Int
  kills           Int
  deaths          Int
  totalKillsMoh   Int

  // Connection stats
  pingCurrent     Int
  pingMean        Int
  pingMeanDeviation Int
  timeCurrent     Int
  timeSum         Int

  // Rating stats
  glicko2Rating   Float
  glicko2Deviation Float

  // Kill/Return breakdown by type
  dfaKills        Int
  dfaReturns      Int
  redKills        Int
  redReturns      Int
  yelKills        Int
  yelReturns      Int
  bluKills        Int
  bluReturns      Int
  dbsKills        Int
  dbsReturns      Int
  dbsAttempts     Int
  bsKills         Int
  bsReturns       Int
  mineKills       Int
  mineReturns     Int
  upcutKills      Int
  upcutReturns    Int
  ydfaKills       Int
  ydfaReturns     Int
  blubsKills      Int
  blubsReturns    Int
  doomKills       Int
  doomReturns     Int
  turKills        Int
  turReturns      Int
  unknKills       Int
  unknReturns     Int
  idleKills       Int
  idleReturns     Int

  createdAt       DateTime @default(now())
}
